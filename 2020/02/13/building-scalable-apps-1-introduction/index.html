<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building Scalable Apps (Part 1) - Introduction | Oslofjord Operations AS - Developer Blog</title>
    <meta name="description" content="Ever launched a fancy new app, only to realize shortly after going live that things had ground to a halt? In a frenzy to get things running again, you realize that testing with 2 or 3 users under opti ...">
    <meta name="generator" content="VuePress 1.3.0">
    <link rel="alternate" type="application/rss+xml" href="https://oslofjord.github.io/rss.xml" title="Oslofjord Operations AS - Developer Blog RSS Feed">
    
    <link rel="preload" href="/assets/css/0.styles.6f85499f.css" as="style"><link rel="preload" href="/assets/js/app.36302c2e.js" as="script"><link rel="preload" href="/assets/js/4.c1dfabb4.js" as="script"><link rel="preload" href="/assets/js/5.712a1168.js" as="script"><link rel="preload" href="/assets/js/10.7db1ed51.js" as="script"><link rel="prefetch" href="/assets/js/1.4bed94b6.js"><link rel="prefetch" href="/assets/js/11.6f871e33.js"><link rel="prefetch" href="/assets/js/12.93dfd9b4.js"><link rel="prefetch" href="/assets/js/13.ecc9056b.js"><link rel="prefetch" href="/assets/js/14.73058881.js"><link rel="prefetch" href="/assets/js/15.facec92c.js"><link rel="prefetch" href="/assets/js/16.8b0bac3e.js"><link rel="prefetch" href="/assets/js/17.26107a9e.js"><link rel="prefetch" href="/assets/js/18.5a5497eb.js"><link rel="prefetch" href="/assets/js/6.c7592a6e.js"><link rel="prefetch" href="/assets/js/7.d661043a.js"><link rel="prefetch" href="/assets/js/8.72615d3c.js"><link rel="prefetch" href="/assets/js/9.8c583639.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.5f066138.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6f85499f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Oslofjord Operations AS - Developer Blog </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Articles</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/2020/02/12/welcome/" class="nav-link">About</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Oslofjord Operations AS - Developer Blog </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Articles</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/2020/02/12/welcome/" class="nav-link">About</a></li> <li class="mobile-nav-item"><a href="/rss.xml" class="feed"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Building Scalable Apps (Part 1) - Introduction
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">Reng van Oord</span> <span itemprop="address">   in Vestfold, Norway</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-02-13T00:00:00.000Z">
      Thu Feb 13 2020
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-d832e844><a href="/tag/Microservices" data-v-d832e844> Microservices </a></li><li class="post-tag" data-v-d832e844><a href="/tag/Testing" data-v-d832e844> Testing </a></li><li class="post-tag" data-v-d832e844><a href="/tag/Apps" data-v-d832e844> Apps </a></li><li class="post-tag" data-v-d832e844><a href="/tag/Scalability" data-v-d832e844> Scalability </a></li><li class="post-tag" data-v-d832e844><a href="/tag/HTTP" data-v-d832e844> HTTP </a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p>Ever launched a fancy new app, only to realize shortly after going live that things had ground to a halt? In a frenzy to get things running again, you realize that testing with 2 or 3 users under optimal conditions simply wasn't good enough.</p> <p><em>In this multipart series we will investigate simple techniques that can be used to ensure that your app keeps running at scale.</em></p> <p><img src="/assets/img/app-crash.5c12bf07.png" alt="App Crash"></p> <blockquote><p>Much of the content in this series is take directly from a real-life app built for <a href="https://oslofjord.com" target="_blank" rel="noopener noreferrer">Oslofjord Convention Center<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
backed by a microservice based infrastructure running ASP.Net Core on Docker Swarm.</p></blockquote> <h2 id="who-is-this-for"><a href="#who-is-this-for" class="header-anchor">#</a> Who Is This For?</h2> <p>This series is aimed at web application, web API and mobile app developers.</p> <p>Many of the examples will be based on the tools we use most frequently: Visual Studio, Microsoft Azure, ASP.Net Core and Docker Swarm.
The principals however, can be applied to almost any web application stack.</p> <h2 id="an-introductory-lesson-keep-your-requests-fast"><a href="#an-introductory-lesson-keep-your-requests-fast" class="header-anchor">#</a> An Introductory Lesson: Keep Your Requests Fast</h2> <p>Imagine a scenario where you've just sent a push notification with a promotion to thousands of users.
Within seconds, hundreds of users will be hitting your APIs at virtually the same time.</p> <p>If all your content is static, that's probably just fine. But what if you're authenticating your user, loading a user profile and loading some custom content,
things might quickly look quite different.</p> <p>The first thing you might notice is that things really start slowing down, and by inspecting your web server logs you'll probably see HTTP <code>500</code>, <code>503</code>, <code>504</code> or even <code>502</code>
errors popping up.</p> <h3 id="what-do-these-http-errors-mean"><a href="#what-do-these-http-errors-mean" class="header-anchor">#</a> What Do These HTTP Errors Mean?</h3> <ul><li><code>500 Server Error</code> is a very generic error which basically means an exception has been thrown. At this point, having some form of logging available would be a great help, but given the circumstances some sort of database timeout or resource exhaustion is a likely scenario.</li> <li><code>502 Bad Gateway</code> means you are running a reverse proxy and the underlying service is not available. A common scenario in a microservice/container based environment where a container has just crashed.</li> <li><code>503 Service Unavailable</code> means your web server has stopped servicing requests. This may be because the process has crashed, or quite likely that all available sockets have been exhausted.</li> <li><code>504 Gateway Timeout</code> similarly to 502 means you are running a reverse proxy and the underlying service has become unresponsive. Another common scenario in a microservice/container based environment.</li></ul> <h3 id="start-with-your-logs"><a href="#start-with-your-logs" class="header-anchor">#</a> Start With Your Logs</h3> <p>Obviously checking logs for basic errors is a great place to start, but if your problems are related to timeouts or resource exhaustion, which is likely under high load, we need to look further.</p> <p>It might also be tempting to start scaling up your server, increasing memory limits, gateway timeouts, socket limits etc. These are all options worth exploring, but don't necessarily solve the real underlying problems.</p> <blockquote><p>The bottom line is that that you need to identify your bottlenecks and ensure that every link in your chain of service and database calls is returning fast!</p></blockquote> <h3 id="identifying-bottlenecks"><a href="#identifying-bottlenecks" class="header-anchor">#</a> Identifying Bottlenecks</h3> <p>In our experience, a great tool for analysing bottlenecks across services is <a href="https://docs.microsoft.com/en-us/azure/azure-monitor/app/app-insights-overview" target="_blank" rel="noopener noreferrer">Azure Application Insights<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.
This tool allows us to trace calls from service to service and provides extremely detailed telemetry. There are many other similar tools such as Stackify and New Relic which provide similar insights.</p> <p><img src="/assets/img/application-insights-1.16059de7.png" alt="Application Insights Example"></p> <p>However, performing a post-mortem becomes tricky once the web server simply stops processing requests (<code>503</code>) and no logs are available.</p> <blockquote><p>At this point the value of systematic load testing, prior to going into production, becomes more obvious.</p></blockquote> <h2 id="optimization-at-all-levels"><a href="#optimization-at-all-levels" class="header-anchor">#</a> Optimization at All Levels</h2> <p>Once we've identified a bottleneck, the fun really starts. There are a multitude of options available for performance tuning before you even consider scaling up your hardware:</p> <ul><li>Database optimizations (particularly indexing and data access methods)</li> <li>Server-side caching</li> <li>Http caching</li> <li>Asynchronous programming</li> <li>Web server tuning</li></ul> <p>The list goes on...</p> <h2 id="what-to-expect-next"><a href="#what-to-expect-next" class="header-anchor">#</a> What To Expect Next</h2> <p>In the follow up posts, we'll be investigating the optimization techniques listed above in more depth. We'll also consider patterns that
allow you to provide user specific content at scale.</p> <h2 id="posts-in-this-series"><a href="#posts-in-this-series" class="header-anchor">#</a> Posts in this Series</h2> <ul><li><a href="/2020/02/13/building-scalable-apps-1-introduction/" class="router-link-exact-active router-link-active">Building Scalable Apps (Part 1) - Introduction</a></li> <li><a href="/2020/02/14/building-scalable-apps-2-database-optimization/">Building Scalable Apps (Part 2) - Database Optimization</a></li> <li>Building Scalable Apps (Part 3) - Server Caching Techniques <em>(Planned)</em></li> <li>Building Scalable Apps (Part 4) - Async Programming <em>(Planned)</em></li> <li>Building Scalable Apps (Part 5) - Http Optimizations <em>(Planned)</em></li> <li>Building Scalable Apps (Part 6) - Event Driven Architectures <em>(Planned)</em></li> <li>Building Scalable Apps (Part 7) - Realistic Load Testing <em>(Planned)</em></li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#who-is-this-for" title="Who Is This For?">Who Is This For?</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#an-introductory-lesson-keep-your-requests-fast" title="An Introductory Lesson: Keep Your Requests Fast">An Introductory Lesson: Keep Your Requests Fast</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#what-do-these-http-errors-mean" title="What Do These HTTP Errors Mean?">What Do These HTTP Errors Mean?</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#start-with-your-logs" title="Start With Your Logs">Start With Your Logs</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#identifying-bottlenecks" title="Identifying Bottlenecks">Identifying Bottlenecks</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#optimization-at-all-levels" title="Optimization at All Levels">Optimization at All Levels</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#what-to-expect-next" title="What To Expect Next">What To Expect Next</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#posts-in-this-series" title="Posts in this Series">Posts in this Series</a></div></div></div></div> <footer class="footer" data-v-582f9766><div class="footer-left-wrap" data-v-582f9766><ul class="contact" data-v-582f9766></ul></div> <div class="footer-right-wrap" data-v-582f9766><ul class="copyright" data-v-582f9766><li class="copyright-item" data-v-582f9766><a href="https://oslofjord.com/en/privacy-policy/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-582f9766>Privacy Policy</a></li><li class="copyright-item" data-v-582f9766><a href="/2020/02/13/building-scalable-apps-1-introduction/.html" class="nav-link" data-v-582f9766>Copyright © 2020 Oslofjord Operations AS</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.36302c2e.js" defer></script><script src="/assets/js/4.c1dfabb4.js" defer></script><script src="/assets/js/5.712a1168.js" defer></script><script src="/assets/js/10.7db1ed51.js" defer></script>
  </body>
</html>
